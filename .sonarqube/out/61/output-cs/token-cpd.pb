∂
~C:\Users\jay.ahir\Desktop\OrchardCore-main\OrchardCore-main\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobDirectory.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public 

class 
BlobDirectory 
:  
IFileStoreEntry! 0
{ 
private 
readonly 
string 
_path  %
;% &
private 
readonly 
DateTime !
_lastModifiedUtc" 2
;2 3
private		 
readonly		 
string		 
_name		  %
;		% &
private

 
readonly

 
string

 
_directoryPath

  .
;

. /
public 
BlobDirectory 
( 
string #
path$ (
,( )
DateTime* 2
lastModifiedUtc3 B
)B C
{ 	
_path 
= 
path 
; 
_lastModifiedUtc 
= 
lastModifiedUtc .
;. /
_name 
= 
System 
. 
IO 
. 
Path "
." #
GetFileName# .
(. /
path/ 3
)3 4
;4 5
_directoryPath 
= 
_path "
." #
Length# )
>* +
_name, 1
.1 2
Length2 8
?9 :
_path; @
.@ A
	SubstringA J
(J K
$numK L
,L M
_pathN S
.S T
LengthT Z
-[ \
_name] b
.b c
Lengthc i
-j k
$numl m
)m n
:o p
$strq s
;s t
} 	
public 
string 
Path 
=> 
_path #
;# $
public 
string 
Name 
=> 
_name #
;# $
public 
string 
DirectoryPath #
=>$ &
_directoryPath' 5
;5 6
public 
long 
Length 
=> 
$num 
;  
public 
DateTime 
LastModifiedUtc '
=>( *
_lastModifiedUtc+ ;
;; <
public 
bool 
IsDirectory 
=>  "
true# '
;' (
}   
}!! ’
yC:\Users\jay.ahir\Desktop\OrchardCore-main\OrchardCore-main\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobFile.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public 

class 
BlobFile 
: 
IFileStoreEntry +
{ 
private 
readonly 
string 
_path  %
;% &
private 
readonly 
string 
_name  %
;% &
private		 
readonly		 
string		 
_directoryPath		  .
;		. /
private

 
readonly

 
long

 
?

 
_length

 &
;

& '
private 
readonly 
DateTimeOffset '
?' (
_lastModified) 6
;6 7
public 
BlobFile 
( 
string 
path #
,# $
long% )
?) *
length+ 1
,1 2
DateTimeOffset3 A
?A B
lastModifiedC O
)O P
{ 	
_path 
= 
path 
; 
_name 
= 
System 
. 
IO 
. 
Path "
." #
GetFileName# .
(. /
_path/ 4
)4 5
;5 6
if 
( 
_name 
== 
_path 
) 
{ 
_directoryPath 
=  
$str! #
;# $
} 
else 
{ 
_directoryPath 
=  
_path! &
.& '
	Substring' 0
(0 1
$num1 2
,2 3
_path4 9
.9 :
Length: @
-A B
_nameC H
.H I
LengthI O
-P Q
$numR S
)S T
;T U
} 
_length 
= 
length 
; 
_lastModified 
= 
lastModified (
;( )
} 	
public 
string 
Path 
=> 
_path #
;# $
public!! 
string!! 
Name!! 
=>!! 
_name!! #
;!!# $
public## 
string## 
DirectoryPath## #
=>##$ &
_directoryPath##' 5
;##5 6
public%% 
long%% 
Length%% 
=>%% 
_length%% %
.%%% &
GetValueOrDefault%%& 7
(%%7 8
)%%8 9
;%%9 :
public'' 
DateTime'' 
LastModifiedUtc'' '
=>''( *
_lastModified''+ 8
.''8 9
GetValueOrDefault''9 J
(''J K
)''K L
.''L M
UtcDateTime''M X
;''X Y
public)) 
bool)) 
IsDirectory)) 
=>))  "
false))# (
;))( )
}** 
}++ Í°
~C:\Users\jay.ahir\Desktop\OrchardCore-main\OrchardCore-main\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobFileStore.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public&& 

class&& 
BlobFileStore&& 
:&&  

IFileStore&&! +
{'' 
private(( 
const(( 
string(( $
_directoryMarkerFileName(( 5
=((6 7
$str((8 O
;((O P
private** 
readonly** 
BlobStorageOptions** +
_options**, 4
;**4 5
private++ 
readonly++ 
IClock++ 
_clock++  &
;++& '
private,, 
readonly,, 
BlobContainerClient,, ,
_blobContainer,,- ;
;,,; <
private-- 
readonly--  
IContentTypeProvider-- - 
_contentTypeProvider--. B
;--B C
private.. 
readonly.. 
string.. 
_basePrefix..  +
=.., -
null... 2
;..2 3
public00 
BlobFileStore00 
(00 
BlobStorageOptions00 /
options000 7
,007 8
IClock009 ?
clock00@ E
,00E F 
IContentTypeProvider00G [
contentTypeProvider00\ o
)00o p
{11 	
_options22 
=22 
options22 
;22 
_clock33 
=33 
clock33 
;33  
_contentTypeProvider44  
=44! "
contentTypeProvider44# 6
;446 7
_blobContainer66 
=66 
new66  
BlobContainerClient66! 4
(664 5
_options665 =
.66= >
ConnectionString66> N
,66N O
_options66P X
.66X Y
ContainerName66Y f
)66f g
;66g h
if88 
(88 
!88 
String88 
.88 
IsNullOrEmpty88 %
(88% &
_options88& .
.88. /
BasePath88/ 7
)887 8
)888 9
{99 
_basePrefix:: 
=:: 
NormalizePrefix:: -
(::- .
_options::. 6
.::6 7
BasePath::7 ?
)::? @
;::@ A
};; 
}<< 	
public>> 
async>> 
Task>> 
<>> 
IFileStoreEntry>> )
>>>) *
GetFileInfoAsync>>+ ;
(>>; <
string>>< B
path>>C G
)>>G H
{?? 	
try@@ 
{AA 
varBB 
blobBB 
=BB 
GetBlobReferenceBB +
(BB+ ,
pathBB, 0
)BB0 1
;BB1 2
varDD 

propertiesDD 
=DD  
awaitDD! &
blobDD' +
.DD+ ,
GetPropertiesAsyncDD, >
(DD> ?
)DD? @
;DD@ A
returnFF 
newFF 
BlobFileFF #
(FF# $
pathFF$ (
,FF( )

propertiesFF* 4
.FF4 5
ValueFF5 :
.FF: ;
ContentLengthFF; H
,FFH I

propertiesFFJ T
.FFT U
ValueFFU Z
.FFZ [
LastModifiedFF[ g
)FFg h
;FFh i
}GG 
catchHH 
(HH "
RequestFailedExceptionHH )
exHH* ,
)HH, -
whenHH. 2
(HH3 4
exHH4 6
.HH6 7
	ErrorCodeHH7 @
==HHA C
BlobErrorCodeHHD Q
.HHQ R
BlobNotFoundHHR ^
)HH^ _
{II 
returnKK 
nullKK 
;KK 
}LL 
catchMM 
(MM 
	ExceptionMM 
exMM 
)MM  
{NN 
throwOO 
newOO 
FileStoreExceptionOO ,
(OO, -
$"OO- /
$strOO/ O
{OOO P
pathOOP T
}OOT U
$strOOU W
"OOW X
,OOX Y
exOOZ \
)OO\ ]
;OO] ^
}PP 
}QQ 	
publicSS 
asyncSS 
TaskSS 
<SS 
IFileStoreEntrySS )
>SS) *!
GetDirectoryInfoAsyncSS+ @
(SS@ A
stringSSA G
pathSSH L
)SSL M
{TT 	
tryUU 
{VV 
ifWW 
(WW 
pathWW 
==WW 
StringWW "
.WW" #
EmptyWW# (
)WW( )
{XX 
returnYY 
newYY 
BlobDirectoryYY ,
(YY, -
pathYY- 1
,YY1 2
_clockYY3 9
.YY9 :
UtcNowYY: @
)YY@ A
;YYA B
}ZZ 
var\\ 
blobDirectory\\ !
=\\" #
await\\$ )%
GetBlobDirectoryReference\\* C
(\\C D
path\\D H
)\\H I
;\\I J
if^^ 
(^^ 
blobDirectory^^ !
!=^^" $
null^^% )
)^^) *
{__ 
return`` 
new`` 
BlobDirectory`` ,
(``, -
path``- 1
,``1 2
_clock``3 9
.``9 :
UtcNow``: @
)``@ A
;``A B
}aa 
returncc 
nullcc 
;cc 
}dd 
catchee 
(ee 
	Exceptionee 
exee 
)ee  
{ff 
throwgg 
newgg 
FileStoreExceptiongg ,
(gg, -
$"gg- /
$strgg/ T
{ggT U
pathggU Y
}ggY Z
$strggZ \
"gg\ ]
,gg] ^
exgg_ a
)gga b
;ggb c
}hh 
}ii 	
publickk 
IAsyncEnumerablekk 
<kk  
IFileStoreEntrykk  /
>kk/ 0$
GetDirectoryContentAsynckk1 I
(kkI J
stringkkJ P
pathkkQ U
=kkV W
nullkkX \
,kk\ ]
boolkk^ b!
includeSubDirectorieskkc x
=kky z
false	kk{ Ä
)
kkÄ Å
{ll 	
trymm 
{nn 
ifoo 
(oo !
includeSubDirectoriesoo )
)oo) *
{pp 
returnqq (
GetDirectoryContentFlatAsyncqq 7
(qq7 8
pathqq8 <
)qq< =
;qq= >
}rr 
elsess 
{tt 
returnuu /
#GetDirectoryContentByHierarchyAsyncuu >
(uu> ?
pathuu? C
)uuC D
;uuD E
}vv 
}ww 
catchxx 
(xx 
	Exceptionxx 
exxx 
)xx  
{yy 
throwzz 
newzz 
FileStoreExceptionzz ,
(zz, -
$"zz- /
$strzz/ W
{zzW X
pathzzX \
}zz\ ]
$strzz] _
"zz_ `
,zz` a
exzzb d
)zzd e
;zze f
}{{ 
}|| 	
private~~ 
async~~ 
IAsyncEnumerable~~ &
<~~& '
IFileStoreEntry~~' 6
>~~6 7/
#GetDirectoryContentByHierarchyAsync~~8 [
(~~[ \
string~~\ b
path~~c g
=~~h i
null~~j n
)~~n o
{ 	
var
ÄÄ 
prefix
ÄÄ 
=
ÄÄ 
this
ÄÄ 
.
ÄÄ 
Combine
ÄÄ %
(
ÄÄ% &
_basePrefix
ÄÄ& 1
,
ÄÄ1 2
path
ÄÄ3 7
)
ÄÄ7 8
;
ÄÄ8 9
prefix
ÅÅ 
=
ÅÅ 
NormalizePrefix
ÅÅ $
(
ÅÅ$ %
prefix
ÅÅ% +
)
ÅÅ+ ,
;
ÅÅ, -
var
ÉÉ 
page
ÉÉ 
=
ÉÉ 
_blobContainer
ÉÉ %
.
ÉÉ% &&
GetBlobsByHierarchyAsync
ÉÉ& >
(
ÉÉ> ?

BlobTraits
ÉÉ? I
.
ÉÉI J
Metadata
ÉÉJ R
,
ÉÉR S

BlobStates
ÉÉT ^
.
ÉÉ^ _
None
ÉÉ_ c
,
ÉÉc d
$str
ÉÉe h
,
ÉÉh i
prefix
ÉÉj p
)
ÉÉp q
;
ÉÉq r
await
ÖÖ 
foreach
ÖÖ 
(
ÖÖ 
var
ÖÖ 
blob
ÖÖ #
in
ÖÖ$ &
page
ÖÖ' +
)
ÖÖ+ ,
{
ÜÜ 
if
áá 
(
áá 
blob
áá 
.
áá 
IsPrefix
áá !
)
áá! "
{
àà 
var
ââ 

folderPath
ââ "
=
ââ# $
blob
ââ% )
.
ââ) *
Prefix
ââ* 0
;
ââ0 1
if
ää 
(
ää 
!
ää 
String
ää 
.
ää  
IsNullOrEmpty
ää  -
(
ää- .
_basePrefix
ää. 9
)
ää9 :
)
ää: ;
{
ãã 

folderPath
åå "
=
åå# $

folderPath
åå% /
.
åå/ 0
	Substring
åå0 9
(
åå9 :
_basePrefix
åå: E
.
ååE F
Length
ååF L
-
ååM N
$num
ååO P
)
ååP Q
;
ååQ R
}
çç 

folderPath
èè 
=
èè  

folderPath
èè! +
.
èè+ ,
Trim
èè, 0
(
èè0 1
$char
èè1 4
)
èè4 5
;
èè5 6
yield
êê 
return
êê  
new
êê! $
BlobDirectory
êê% 2
(
êê2 3

folderPath
êê3 =
,
êê= >
_clock
êê? E
.
êêE F
UtcNow
êêF L
)
êêL M
;
êêM N
}
ëë 
else
íí 
{
ìì 
var
îî 
itemName
îî  
=
îî! "
Path
îî# '
.
îî' (
GetFileName
îî( 3
(
îî3 4

WebUtility
îî4 >
.
îî> ?
	UrlDecode
îî? H
(
îîH I
blob
îîI M
.
îîM N
Blob
îîN R
.
îîR S
Name
îîS W
)
îîW X
)
îîX Y
.
îîY Z
Trim
îîZ ^
(
îî^ _
$char
îî_ b
)
îîb c
;
îîc d
if
ññ 
(
ññ 
itemName
ññ  
!=
ññ! #&
_directoryMarkerFileName
ññ$ <
)
ññ< =
{
óó 
var
òò 
itemPath
òò $
=
òò% &
this
òò' +
.
òò+ ,
Combine
òò, 3
(
òò3 4
path
òò4 8
?
òò8 9
.
òò9 :
Trim
òò: >
(
òò> ?
$char
òò? B
)
òòB C
,
òòC D
itemName
òòE M
)
òòM N
;
òòN O
yield
ôô 
return
ôô $
new
ôô% (
BlobFile
ôô) 1
(
ôô1 2
itemPath
ôô2 :
,
ôô: ;
blob
ôô< @
.
ôô@ A
Blob
ôôA E
.
ôôE F

Properties
ôôF P
.
ôôP Q
ContentLength
ôôQ ^
,
ôô^ _
blob
ôô` d
.
ôôd e
Blob
ôôe i
.
ôôi j

Properties
ôôj t
.
ôôt u
LastModifiedôôu Å
)ôôÅ Ç
;ôôÇ É
}
öö 
}
õõ 
}
úú 
}
ùù 	
private
üü 
async
üü 
IAsyncEnumerable
üü &
<
üü& '
IFileStoreEntry
üü' 6
>
üü6 7*
GetDirectoryContentFlatAsync
üü8 T
(
üüT U
string
üüU [
path
üü\ `
=
üüa b
null
üüc g
)
üüg h
{
†† 	
var
¢¢ 
directories
¢¢ 
=
¢¢ 
new
¢¢ !
HashSet
¢¢" )
<
¢¢) *
string
¢¢* 0
>
¢¢0 1
(
¢¢1 2
)
¢¢2 3
;
¢¢3 4
var
§§ 
prefix
§§ 
=
§§ 
this
§§ 
.
§§ 
Combine
§§ %
(
§§% &
_basePrefix
§§& 1
,
§§1 2
path
§§3 7
)
§§7 8
;
§§8 9
prefix
•• 
=
•• 
NormalizePrefix
•• $
(
••$ %
prefix
••% +
)
••+ ,
;
••, -
var
ßß 
page
ßß 
=
ßß 
_blobContainer
ßß %
.
ßß% &
GetBlobsAsync
ßß& 3
(
ßß3 4

BlobTraits
ßß4 >
.
ßß> ?
Metadata
ßß? G
,
ßßG H

BlobStates
ßßI S
.
ßßS T
None
ßßT X
,
ßßX Y
prefix
ßßZ `
)
ßß` a
;
ßßa b
await
®® 
foreach
®® 
(
®® 
var
®® 
blob
®® #
in
®®$ &
page
®®' +
)
®®+ ,
{
©© 
var
™™ 
name
™™ 
=
™™ 

WebUtility
™™ %
.
™™% &
	UrlDecode
™™& /
(
™™/ 0
blob
™™0 4
.
™™4 5
Name
™™5 9
)
™™9 :
;
™™: ;
var
ØØ 
	directory
ØØ 
=
ØØ 
Path
ØØ  $
.
ØØ$ %
GetDirectoryName
ØØ% 5
(
ØØ5 6
name
ØØ6 :
)
ØØ: ;
;
ØØ; <
if
±± 
(
±± 
!
±± 
String
±± 
.
±± 
IsNullOrEmpty
±± )
(
±±) *
_basePrefix
±±* 5
)
±±5 6
)
±±6 7
{
≤≤ 
	directory
≥≥ 
=
≥≥ 
	directory
≥≥  )
.
≥≥) *
	Substring
≥≥* 3
(
≥≥3 4
_basePrefix
≥≥4 ?
.
≥≥? @
Length
≥≥@ F
-
≥≥G H
$num
≥≥I J
)
≥≥J K
;
≥≥K L
}
¥¥ 
if
∂∂ 
(
∂∂ 
!
∂∂ 
String
∂∂ 
.
∂∂ 
IsNullOrEmpty
∂∂ )
(
∂∂) *
	directory
∂∂* 3
)
∂∂3 4
&&
∂∂5 7
!
∂∂8 9
directories
∂∂9 D
.
∂∂D E
Contains
∂∂E M
(
∂∂M N
	directory
∂∂N W
)
∂∂W X
&&
∂∂Y [
(
∂∂\ ]
String
∂∂] c
.
∂∂c d
IsNullOrEmpty
∂∂d q
(
∂∂q r
path
∂∂r v
)
∂∂v w
?
∂∂x y
true
∂∂z ~
:∂∂ Ä
!∂∂Å Ç
	directory∂∂Ç ã
.∂∂ã å
EndsWith∂∂å î
(∂∂î ï
path∂∂ï ô
)∂∂ô ö
)∂∂ö õ
)∂∂õ ú
{
∑∑ 
directories
∏∏ 
.
∏∏  
Add
∏∏  #
(
∏∏# $
	directory
∏∏$ -
)
∏∏- .
;
∏∏. /
yield
ππ 
return
ππ  
new
ππ! $
BlobDirectory
ππ% 2
(
ππ2 3
	directory
ππ3 <
,
ππ< =
_clock
ππ> D
.
ππD E
UtcNow
ππE K
)
ππK L
;
ππL M
}
∫∫ 
if
ΩΩ 
(
ΩΩ 
!
ΩΩ 
name
ΩΩ 
.
ΩΩ 
EndsWith
ΩΩ "
(
ΩΩ" #&
_directoryMarkerFileName
ΩΩ# ;
)
ΩΩ; <
)
ΩΩ< =
{
ææ 
if
øø 
(
øø 
!
øø 
String
øø 
.
øø  
IsNullOrEmpty
øø  -
(
øø- .
_basePrefix
øø. 9
)
øø9 :
)
øø: ;
{
¿¿ 
name
¡¡ 
=
¡¡ 
name
¡¡ #
.
¡¡# $
	Substring
¡¡$ -
(
¡¡- .
_basePrefix
¡¡. 9
.
¡¡9 :
Length
¡¡: @
-
¡¡A B
$num
¡¡C D
)
¡¡D E
;
¡¡E F
}
¬¬ 
yield
√√ 
return
√√  
new
√√! $
BlobFile
√√% -
(
√√- .
name
√√. 2
.
√√2 3
Trim
√√3 7
(
√√7 8
$char
√√8 ;
)
√√; <
,
√√< =
blob
√√> B
.
√√B C

Properties
√√C M
.
√√M N
ContentLength
√√N [
,
√√[ \
blob
√√] a
.
√√a b

Properties
√√b l
.
√√l m
LastModified
√√m y
)
√√y z
;
√√z {
}
ƒƒ 
}
≈≈ 
}
∆∆ 	
public
»» 
async
»» 
Task
»» 
<
»» 
bool
»» 
>
»» %
TryCreateDirectoryAsync
»»  7
(
»»7 8
string
»»8 >
path
»»? C
)
»»C D
{
…… 	
try
ÕÕ 
{
ŒŒ 
var
œœ 
blobFile
œœ 
=
œœ 
GetBlobReference
œœ /
(
œœ/ 0
path
œœ0 4
)
œœ4 5
;
œœ5 6
if
—— 
(
—— 
await
—— 
blobFile
—— "
.
——" #
ExistsAsync
——# .
(
——. /
)
——/ 0
)
——0 1
{
““ 
throw
”” 
new
””  
FileStoreException
”” 0
(
””0 1
$"
””1 3
$str
””3 ]
{
””] ^
path
””^ b
}
””b c
$str””c Ç
"””Ç É
)””É Ñ
;””Ñ Ö
}
‘‘ 
var
÷÷ 
blobDirectory
÷÷ !
=
÷÷" #
await
÷÷$ )'
GetBlobDirectoryReference
÷÷* C
(
÷÷C D
path
÷÷D H
)
÷÷H I
;
÷÷I J
if
◊◊ 
(
◊◊ 
blobDirectory
◊◊ !
==
◊◊" $
null
◊◊% )
)
◊◊) *
{
ÿÿ 
await
ŸŸ "
CreateDirectoryAsync
ŸŸ .
(
ŸŸ. /
path
ŸŸ/ 3
)
ŸŸ3 4
;
ŸŸ4 5
}
⁄⁄ 
return
‹‹ 
true
‹‹ 
;
‹‹ 
}
›› 
catch
ﬁﬁ 
(
ﬁﬁ  
FileStoreException
ﬁﬁ %
)
ﬁﬁ% &
{
ﬂﬂ 
throw
‡‡ 
;
‡‡ 
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
ex
‚‚ 
)
‚‚  
{
„„ 
throw
‰‰ 
new
‰‰  
FileStoreException
‰‰ ,
(
‰‰, -
$"
‰‰- /
$str
‰‰/ H
{
‰‰H I
path
‰‰I M
}
‰‰M N
$str
‰‰N P
"
‰‰P Q
,
‰‰Q R
ex
‰‰S U
)
‰‰U V
;
‰‰V W
}
ÂÂ 
}
ÊÊ 	
public
ËË 
async
ËË 
Task
ËË 
<
ËË 
bool
ËË 
>
ËË  
TryDeleteFileAsync
ËË  2
(
ËË2 3
string
ËË3 9
path
ËË: >
)
ËË> ?
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
var
ÏÏ 
blob
ÏÏ 
=
ÏÏ 
GetBlobReference
ÏÏ +
(
ÏÏ+ ,
path
ÏÏ, 0
)
ÏÏ0 1
;
ÏÏ1 2
return
ÓÓ 
await
ÓÓ 
blob
ÓÓ !
.
ÓÓ! "!
DeleteIfExistsAsync
ÓÓ" 5
(
ÓÓ5 6
)
ÓÓ6 7
;
ÓÓ7 8
}
ÔÔ 
catch
 
(
 
	Exception
 
ex
 
)
  
{
ÒÒ 
throw
ÚÚ 
new
ÚÚ  
FileStoreException
ÚÚ ,
(
ÚÚ, -
$"
ÚÚ- /
$str
ÚÚ/ C
{
ÚÚC D
path
ÚÚD H
}
ÚÚH I
$str
ÚÚI K
"
ÚÚK L
,
ÚÚL M
ex
ÚÚN P
)
ÚÚP Q
;
ÚÚQ R
}
ÛÛ 
}
ÙÙ 	
public
ˆˆ 
async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
bool
ˆˆ 
>
ˆˆ %
TryDeleteDirectoryAsync
ˆˆ  7
(
ˆˆ7 8
string
ˆˆ8 >
path
ˆˆ? C
)
ˆˆC D
{
˜˜ 	
try
¯¯ 
{
˘˘ 
if
˙˙ 
(
˙˙ 
String
˙˙ 
.
˙˙ 
IsNullOrEmpty
˙˙ (
(
˙˙( )
path
˙˙) -
)
˙˙- .
)
˙˙. /
{
˚˚ 
throw
¸¸ 
new
¸¸  
FileStoreException
¸¸ 0
(
¸¸0 1
$str
¸¸1 T
)
¸¸T U
;
¸¸U V
}
˝˝ 
var
ˇˇ 
blobsWereDeleted
ˇˇ $
=
ˇˇ% &
false
ˇˇ' ,
;
ˇˇ, -
var
ÄÄ 
prefix
ÄÄ 
=
ÄÄ 
this
ÄÄ !
.
ÄÄ! "
Combine
ÄÄ" )
(
ÄÄ) *
_basePrefix
ÄÄ* 5
,
ÄÄ5 6
path
ÄÄ7 ;
)
ÄÄ; <
;
ÄÄ< =
prefix
ÅÅ 
=
ÅÅ 
this
ÅÅ 
.
ÅÅ 
NormalizePrefix
ÅÅ -
(
ÅÅ- .
prefix
ÅÅ. 4
)
ÅÅ4 5
;
ÅÅ5 6
var
ÉÉ 
page
ÉÉ 
=
ÉÉ 
_blobContainer
ÉÉ )
.
ÉÉ) *
GetBlobsAsync
ÉÉ* 7
(
ÉÉ7 8

BlobTraits
ÉÉ8 B
.
ÉÉB C
Metadata
ÉÉC K
,
ÉÉK L

BlobStates
ÉÉM W
.
ÉÉW X
None
ÉÉX \
,
ÉÉ\ ]
prefix
ÉÉ^ d
)
ÉÉd e
;
ÉÉe f
await
ÑÑ 
foreach
ÑÑ 
(
ÑÑ 
var
ÑÑ "
blob
ÑÑ# '
in
ÑÑ( *
page
ÑÑ+ /
)
ÑÑ/ 0
{
ÖÖ 
var
ÜÜ 
blobReference
ÜÜ %
=
ÜÜ& '
_blobContainer
ÜÜ( 6
.
ÜÜ6 7
GetBlobClient
ÜÜ7 D
(
ÜÜD E
blob
ÜÜE I
.
ÜÜI J
Name
ÜÜJ N
)
ÜÜN O
;
ÜÜO P
await
áá 
blobReference
áá '
.
áá' (!
DeleteIfExistsAsync
áá( ;
(
áá; <#
DeleteSnapshotsOption
áá< Q
.
ááQ R
IncludeSnapshots
ááR b
)
ááb c
;
áác d
blobsWereDeleted
àà $
=
àà% &
true
àà' +
;
àà+ ,
}
ââ 
return
ãã 
blobsWereDeleted
ãã '
;
ãã' (
}
åå 
catch
çç 
(
çç  
FileStoreException
çç %
)
çç% &
{
éé 
throw
èè 
;
èè 
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
ex
ëë 
)
ëë  
{
íí 
throw
ìì 
new
ìì  
FileStoreException
ìì ,
(
ìì, -
$"
ìì- /
$str
ìì/ H
{
ììH I
path
ììI M
}
ììM N
$str
ììN P
"
ììP Q
,
ììQ R
ex
ììS U
)
ììU V
;
ììV W
}
îî 
}
ïï 	
public
óó 
async
óó 
Task
óó 
MoveFileAsync
óó '
(
óó' (
string
óó( .
oldPath
óó/ 6
,
óó6 7
string
óó8 >
newPath
óó? F
)
óóF G
{
òò 	
try
ôô 
{
öö 
await
õõ 
CopyFileAsync
õõ #
(
õõ# $
oldPath
õõ$ +
,
õõ+ ,
newPath
õõ- 4
)
õõ4 5
;
õõ5 6
await
úú  
TryDeleteFileAsync
úú (
(
úú( )
oldPath
úú) 0
)
úú0 1
;
úú1 2
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
ex
ûû 
)
ûû  
{
üü 
throw
†† 
new
††  
FileStoreException
†† ,
(
††, -
$"
††- /
$str
††/ A
{
††A B
oldPath
††B I
}
††I J
$str
††J P
{
††P Q
newPath
††Q X
}
††X Y
$str
††Y [
"
††[ \
,
††\ ]
ex
††^ `
)
††` a
;
††a b
}
°° 
}
¢¢ 	
public
§§ 
async
§§ 
Task
§§ 
CopyFileAsync
§§ '
(
§§' (
string
§§( .
srcPath
§§/ 6
,
§§6 7
string
§§8 >
dstPath
§§? F
)
§§F G
{
•• 	
try
¶¶ 
{
ßß 
if
®® 
(
®® 
srcPath
®® 
==
®® 
dstPath
®® &
)
®®& '
{
©© 
throw
™™ 
new
™™ 
ArgumentException
™™ /
(
™™/ 0
$"
™™0 2
$str
™™2 A
{
™™A B
nameof
™™B H
(
™™H I
srcPath
™™I P
)
™™P Q
}
™™Q R
$str
™™R W
{
™™W X
nameof
™™X ^
(
™™^ _
dstPath
™™_ f
)
™™f g
}
™™g h
$str
™™h ~
"
™™~ 
)™™ Ä
;™™Ä Å
}
´´ 
var
≠≠ 
oldBlob
≠≠ 
=
≠≠ 
GetBlobReference
≠≠ .
(
≠≠. /
srcPath
≠≠/ 6
)
≠≠6 7
;
≠≠7 8
var
ÆÆ 
newBlob
ÆÆ 
=
ÆÆ 
GetBlobReference
ÆÆ .
(
ÆÆ. /
dstPath
ÆÆ/ 6
)
ÆÆ6 7
;
ÆÆ7 8
if
∞∞ 
(
∞∞ 
!
∞∞ 
await
∞∞ 
oldBlob
∞∞ "
.
∞∞" #
ExistsAsync
∞∞# .
(
∞∞. /
)
∞∞/ 0
)
∞∞0 1
{
±± 
throw
≤≤ 
new
≤≤  
FileStoreException
≤≤ 0
(
≤≤0 1
$"
≤≤1 3
$str
≤≤3 E
{
≤≤E F
srcPath
≤≤F M
}
≤≤M N
$str
≤≤N j
"
≤≤j k
)
≤≤k l
;
≤≤l m
}
≥≥ 
if
µµ 
(
µµ 
await
µµ 
newBlob
µµ !
.
µµ! "
ExistsAsync
µµ" -
(
µµ- .
)
µµ. /
)
µµ/ 0
{
∂∂ 
throw
∑∑ 
new
∑∑  
FileStoreException
∑∑ 0
(
∑∑0 1
$"
∑∑1 3
$str
∑∑3 E
{
∑∑E F
srcPath
∑∑F M
}
∑∑M N
$str
∑∑N 
{∑∑ Ä
dstPath∑∑Ä á
}∑∑á à
$str∑∑à ä
"∑∑ä ã
)∑∑ã å
;∑∑å ç
}
∏∏ 
await
∫∫ 
newBlob
∫∫ 
.
∫∫ #
StartCopyFromUriAsync
∫∫ 3
(
∫∫3 4
oldBlob
∫∫4 ;
.
∫∫; <
Uri
∫∫< ?
)
∫∫? @
;
∫∫@ A
await
ºº 
Task
ºº 
.
ºº 
Delay
ºº  
(
ºº  !
$num
ºº! $
)
ºº$ %
;
ºº% &
var
ΩΩ 

properties
ΩΩ 
=
ΩΩ  
await
ΩΩ! &
newBlob
ΩΩ' .
.
ΩΩ. / 
GetPropertiesAsync
ΩΩ/ A
(
ΩΩA B
)
ΩΩB C
;
ΩΩC D
while
øø 
(
øø 

properties
øø !
.
øø! "
Value
øø" '
.
øø' (

CopyStatus
øø( 2
==
øø3 5

CopyStatus
øø6 @
.
øø@ A
Pending
øøA H
)
øøH I
{
¿¿ 
await
¡¡ 
Task
¡¡ 
.
¡¡ 
Delay
¡¡ $
(
¡¡$ %
$num
¡¡% (
)
¡¡( )
;
¡¡) *

properties
√√ 
=
√√  
await
√√! &
newBlob
√√' .
.
√√. / 
GetPropertiesAsync
√√/ A
(
√√A B
)
√√B C
;
√√C D
}
ƒƒ 
if
∆∆ 
(
∆∆ 

properties
∆∆ 
.
∆∆ 
Value
∆∆ $
.
∆∆$ %

CopyStatus
∆∆% /
!=
∆∆0 2

CopyStatus
∆∆3 =
.
∆∆= >
Success
∆∆> E
)
∆∆E F
{
«« 
throw
»» 
new
»»  
FileStoreException
»» 0
(
»»0 1
$"
»»1 3
$str
»»3 M
{
»»M N
srcPath
»»N U
}
»»U V
$str
»»V {
{
»»{ |

properties»»| Ü
.»»Ü á
Value»»á å
.»»å ç

CopyStatus»»ç ó
}»»ó ò
$str»»ò ©
{»»© ™

properties»»™ ¥
.»»¥ µ
Value»»µ ∫
.»»∫ ª%
CopyStatusDescription»»ª –
}»»– —
$str»»— “
"»»“ ”
)»»” ‘
;»»‘ ’
}
…… 
}
   
catch
ÀÀ 
(
ÀÀ  
FileStoreException
ÀÀ %
)
ÀÀ% &
{
ÃÃ 
throw
ÕÕ 
;
ÕÕ 
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
ex
œœ 
)
œœ  
{
–– 
throw
—— 
new
——  
FileStoreException
—— ,
(
——, -
$"
——- /
$str
——/ A
{
——A B
srcPath
——B I
}
——I J
$str
——J P
{
——P Q
dstPath
——Q X
}
——X Y
$str
——Y [
"
——[ \
,
——\ ]
ex
——^ `
)
——` a
;
——a b
}
““ 
}
”” 	
public
’’ 
async
’’ 
Task
’’ 
<
’’ 
Stream
’’  
>
’’  ! 
GetFileStreamAsync
’’" 4
(
’’4 5
string
’’5 ;
path
’’< @
)
’’@ A
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
var
ŸŸ 
blob
ŸŸ 
=
ŸŸ 
GetBlobReference
ŸŸ +
(
ŸŸ+ ,
path
ŸŸ, 0
)
ŸŸ0 1
;
ŸŸ1 2
if
€€ 
(
€€ 
!
€€ 
await
€€ 
blob
€€ 
.
€€  
ExistsAsync
€€  +
(
€€+ ,
)
€€, -
)
€€- .
{
‹‹ 
throw
›› 
new
››  
FileStoreException
›› 0
(
››0 1
$"
››1 3
$str
››3 \
{
››\ ]
path
››] a
}
››a b
$str
››b s
"
››s t
)
››t u
;
››u v
}
ﬁﬁ 
return
‡‡ 
(
‡‡ 
await
‡‡ 
blob
‡‡ "
.
‡‡" #
DownloadAsync
‡‡# 0
(
‡‡0 1
)
‡‡1 2
)
‡‡2 3
.
‡‡3 4
Value
‡‡4 9
.
‡‡9 :
Content
‡‡: A
;
‡‡A B
}
·· 
catch
‚‚ 
(
‚‚  
FileStoreException
‚‚ %
)
‚‚% &
{
„„ 
throw
‰‰ 
;
‰‰ 
}
ÂÂ 
catch
ÊÊ 
(
ÊÊ 
	Exception
ÊÊ 
ex
ÊÊ 
)
ÊÊ  
{
ÁÁ 
throw
ËË 
new
ËË  
FileStoreException
ËË ,
(
ËË, -
$"
ËË- /
$str
ËË/ S
{
ËËS T
path
ËËT X
}
ËËX Y
$str
ËËY [
"
ËË[ \
,
ËË\ ]
ex
ËË^ `
)
ËË` a
;
ËËa b
}
ÈÈ 
}
ÍÍ 	
public
ÓÓ 
Task
ÓÓ 
<
ÓÓ 
Stream
ÓÓ 
>
ÓÓ  
GetFileStreamAsync
ÓÓ .
(
ÓÓ. /
IFileStoreEntry
ÓÓ/ >
fileStoreEntry
ÓÓ? M
)
ÓÓM N
{
ÔÔ 	
return
  
GetFileStreamAsync
 %
(
% &
fileStoreEntry
& 4
.
4 5
Path
5 9
)
9 :
;
: ;
}
ÒÒ 	
public
ÛÛ 
async
ÛÛ 
Task
ÛÛ 
<
ÛÛ 
string
ÛÛ  
>
ÛÛ  !'
CreateFileFromStreamAsync
ÛÛ" ;
(
ÛÛ; <
string
ÛÛ< B
path
ÛÛC G
,
ÛÛG H
Stream
ÛÛI O
inputStream
ÛÛP [
,
ÛÛ[ \
bool
ÛÛ] a
	overwrite
ÛÛb k
=
ÛÛl m
false
ÛÛn s
)
ÛÛs t
{
ÙÙ 	
try
ıı 
{
ˆˆ 
var
˜˜ 
blob
˜˜ 
=
˜˜ 
GetBlobReference
˜˜ +
(
˜˜+ ,
path
˜˜, 0
)
˜˜0 1
;
˜˜1 2
if
˘˘ 
(
˘˘ 
!
˘˘ 
	overwrite
˘˘ 
&&
˘˘ !
await
˘˘" '
blob
˘˘( ,
.
˘˘, -
ExistsAsync
˘˘- 8
(
˘˘8 9
)
˘˘9 :
)
˘˘: ;
{
˙˙ 
throw
˚˚ 
new
˚˚  
FileStoreException
˚˚ 0
(
˚˚0 1
$"
˚˚1 3
$str
˚˚3 G
{
˚˚G H
path
˚˚H L
}
˚˚L M
$str
˚˚M i
"
˚˚i j
)
˚˚j k
;
˚˚k l
}
¸¸ "
_contentTypeProvider
˛˛ $
.
˛˛$ %
TryGetContentType
˛˛% 6
(
˛˛6 7
path
˛˛7 ;
,
˛˛; <
out
˛˛= @
var
˛˛A D
contentType
˛˛E P
)
˛˛P Q
;
˛˛Q R
var
ÄÄ 
headers
ÄÄ 
=
ÄÄ 
new
ÄÄ !
BlobHttpHeaders
ÄÄ" 1
{
ÅÅ 
ContentType
ÇÇ 
=
ÇÇ  !
contentType
ÇÇ" -
??
ÇÇ. 0
$str
ÇÇ1 K
}
ÉÉ 
;
ÉÉ 
await
ÖÖ 
blob
ÖÖ 
.
ÖÖ 
UploadAsync
ÖÖ &
(
ÖÖ& '
inputStream
ÖÖ' 2
,
ÖÖ2 3
headers
ÖÖ4 ;
)
ÖÖ; <
;
ÖÖ< =
return
áá 
path
áá 
;
áá 
}
àà 
catch
ââ 
(
ââ  
FileStoreException
ââ %
)
ââ% &
{
ää 
throw
ãã 
;
ãã 
}
åå 
catch
çç 
(
çç 
	Exception
çç 
ex
çç 
)
çç  
{
éé 
throw
èè 
new
èè  
FileStoreException
èè ,
(
èè, -
$"
èè- /
$str
èè/ C
{
èèC D
path
èèD H
}
èèH I
$str
èèI K
"
èèK L
,
èèL M
ex
èèN P
)
èèP Q
;
èèQ R
}
êê 
}
ëë 	
private
ìì 

BlobClient
ìì 
GetBlobReference
ìì +
(
ìì+ ,
string
ìì, 2
path
ìì3 7
)
ìì7 8
{
îî 	
var
ïï 
blobPath
ïï 
=
ïï 
this
ïï 
.
ïï  
Combine
ïï  '
(
ïï' (
_options
ïï( 0
.
ïï0 1
BasePath
ïï1 9
,
ïï9 :
path
ïï; ?
)
ïï? @
;
ïï@ A
var
ññ 
blob
ññ 
=
ññ 
_blobContainer
ññ %
.
ññ% &
GetBlobClient
ññ& 3
(
ññ3 4
blobPath
ññ4 <
)
ññ< =
;
ññ= >
return
òò 
blob
òò 
;
òò 
}
ôô 	
private
õõ 
async
õõ 
Task
õõ 
<
õõ 
BlobHierarchyItem
õõ ,
>
õõ, -'
GetBlobDirectoryReference
õõ. G
(
õõG H
string
õõH N
path
õõO S
)
õõS T
{
úú 	
var
ùù 
prefix
ùù 
=
ùù 
this
ùù 
.
ùù 
Combine
ùù %
(
ùù% &
_basePrefix
ùù& 1
,
ùù1 2
path
ùù3 7
)
ùù7 8
;
ùù8 9
prefix
ûû 
=
ûû 
NormalizePrefix
ûû $
(
ûû$ %
prefix
ûû% +
)
ûû+ ,
;
ûû, -
var
°° 
page
°° 
=
°° 
_blobContainer
°° %
.
°°% &&
GetBlobsByHierarchyAsync
°°& >
(
°°> ?

BlobTraits
°°? I
.
°°I J
Metadata
°°J R
,
°°R S

BlobStates
°°T ^
.
°°^ _
None
°°_ c
,
°°c d
$str
°°e h
,
°°h i
prefix
°°j p
)
°°p q
;
°°q r
var
££ 

enumerator
££ 
=
££ 
page
££ !
.
££! " 
GetAsyncEnumerator
££" 4
(
££4 5
)
££5 6
;
££6 7
var
•• 
result
•• 
=
•• 
await
•• 

enumerator
•• )
.
••) *
MoveNextAsync
••* 7
(
••7 8
)
••8 9
;
••9 :
if
¶¶ 
(
¶¶ 
result
¶¶ 
)
¶¶ 
{
ßß 
return
®® 

enumerator
®® !
.
®®! "
Current
®®" )
;
®®) *
}
©© 
return
´´ 
null
´´ 
;
´´ 
}
¨¨ 	
private
ÆÆ 
async
ÆÆ 
Task
ÆÆ "
CreateDirectoryAsync
ÆÆ /
(
ÆÆ/ 0
string
ÆÆ0 6
path
ÆÆ7 ;
)
ÆÆ; <
{
ØØ 	
var
∞∞ 
placeholderBlob
∞∞ 
=
∞∞  !
GetBlobReference
∞∞" 2
(
∞∞2 3
this
∞∞3 7
.
∞∞7 8
Combine
∞∞8 ?
(
∞∞? @
path
∞∞@ D
,
∞∞D E&
_directoryMarkerFileName
∞∞F ^
)
∞∞^ _
)
∞∞_ `
;
∞∞` a
using
≥≥ 
(
≥≥ 
var
≥≥ 
stream
≥≥ 
=
≥≥ 
new
≥≥  #
MemoryStream
≥≥$ 0
(
≥≥0 1
Encoding
≥≥1 9
.
≥≥9 :
UTF8
≥≥: >
.
≥≥> ?
GetBytes
≥≥? G
(
≥≥G H
$str≥≥H õ
)≥≥õ ú
)≥≥ú ù
)≥≥ù û
{
¥¥ 
await
µµ 
placeholderBlob
µµ %
.
µµ% &
UploadAsync
µµ& 1
(
µµ1 2
stream
µµ2 8
)
µµ8 9
;
µµ9 :
}
∂∂ 
}
∑∑ 	
private
ºº 
string
ºº 
NormalizePrefix
ºº &
(
ºº& '
string
ºº' -
prefix
ºº. 4
)
ºº4 5
{
ΩΩ 	
prefix
ææ 
=
ææ 
prefix
ææ 
.
ææ 
Trim
ææ  
(
ææ  !
$char
ææ! $
)
ææ$ %
+
ææ& '
$char
ææ( +
;
ææ+ ,
if
øø 
(
øø 
prefix
øø 
.
øø 
Length
øø 
==
øø  
$num
øø! "
)
øø" #
{
¿¿ 
return
¡¡ 
String
¡¡ 
.
¡¡ 
Empty
¡¡ #
;
¡¡# $
}
¬¬ 
else
√√ 
{
ƒƒ 
return
≈≈ 
prefix
≈≈ 
;
≈≈ 
}
∆∆ 
}
«« 	
}
»» 
}…… ¯
ÉC:\Users\jay.ahir\Desktop\OrchardCore-main\OrchardCore-main\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobStorageOptions.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public 

abstract 
class 
BlobStorageOptions ,
{ 
public 
string 
ConnectionString &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
ContainerName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
BasePath 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} 